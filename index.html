<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Questionário de Maturidade do Ciclo da Receita</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        :root {
          /* Colors - Updated with brand colors */
          --color-primary: #EB6856; /* Orange */
          --color-secondary-brand: #2D2357; /* Blue */
          
          --color-background: #fdfcfa;
          --color-surface: #ffffff;
          --color-text: #2D2357; /* Dark Blue for text */
          --color-text-secondary: #5b647c;
          
          --color-primary-hover: #e55a47;
          --color-primary-active: #d94c38;
          --color-secondary: rgba(45, 35, 87, 0.1); /* Light version of blue */
          --color-secondary-hover: rgba(45, 35, 87, 0.15);
          --color-secondary-active: rgba(45, 35, 87, 0.2);
          
          --color-border: rgba(45, 35, 87, 0.2);
          --color-btn-primary-text: #ffffff;
          --color-card-border: rgba(45, 35, 87, 0.1);
          --color-card-border-inner: rgba(45, 35, 87, 0.1);
          
          --color-error: #d32f2f;
          --color-success: #388e3c;
          --color-warning: #f57c00;
          --color-info: #1976d2;
          --color-focus-ring: rgba(235, 104, 86, 0.4);

          /* Other variables remain the same */
          --font-family-base: "Inter", -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
          --font-size-base: 16px;
          --line-height-normal: 1.6;
          --radius-base: 8px;
          --radius-lg: 12px;
          --shadow-sm: 0 2px 4px rgba(0,0,0,0.05);
          --shadow-md: 0 4px 10px rgba(0,0,0,0.08);
          --shadow-lg: 0 10px 20px rgba(0,0,0,0.1);
          --duration-normal: 250ms;
          --ease-standard: cubic-bezier(0.16, 1, 0.3, 1);
        }

        /* Base styles */
        html {
          font-size: var(--font-size-base);
          font-family: var(--font-family-base);
          line-height: var(--line-height-normal);
          color: var(--color-text);
          background-color: var(--color-background);
          -webkit-font-smoothing: antialiased;
          box-sizing: border-box;
        }

        body {
          margin: 0;
          padding: 0;
        }

        *, *::before, *::after {
          box-sizing: inherit;
        }

        h1, h2, h3, h4 {
          font-weight: 700;
          line-height: 1.2;
          color: var(--color-secondary-brand);
        }

        h1 { font-size: 3rem; }
        h2 { font-size: 2rem; }
        h3 { font-size: 1.5rem; }
        h4 { font-size: 1.25rem; }

        .container {
          width: 100%;
          max-width: 1200px;
          margin: 0 auto;
          padding: 0 24px;
        }

        /* Page Management */
        .page {
          display: none;
          padding: 4rem 0;
        }

        .page.active {
          display: block;
          animation: fadeIn 0.5s ease-in-out;
        }

        @keyframes fadeIn {
          from { opacity: 0; }
          to { opacity: 1; }
        }

        /* Button Styles */
        .btn {
          display: inline-flex;
          align-items: center;
          justify-content: center;
          padding: 14px 28px;
          border-radius: var(--radius-base);
          font-size: 1rem;
          font-weight: 600;
          cursor: pointer;
          transition: all var(--duration-normal) var(--ease-standard);
          border: 2px solid transparent;
          text-decoration: none;
          width: 100%; /* Default to full-width for mobile-first */
        }
        .btn i {
            margin-right: 8px;
        }
        .btn:last-child i {
            margin-left: 8px;
            margin-right: 0;
        }
        .btn--primary {
          background-color: var(--color-primary);
          color: var(--color-btn-primary-text);
          border-color: var(--color-primary);
        }
        .btn--primary:hover {
          background-color: var(--color-primary-hover);
          border-color: var(--color-primary-hover);
          transform: translateY(-3px);
          box-shadow: var(--shadow-md);
        }
        .btn--outline {
          background-color: transparent;
          color: var(--color-primary);
          border-color: var(--color-primary);
        }
        .btn--outline:hover {
          background-color: var(--color-primary);
          color: var(--color-btn-primary-text);
        }
        .btn:disabled {
          opacity: 0.5;
          cursor: not-allowed;
          transform: none;
          box-shadow: none;
        }
        
        @media (min-width: 768px) {
            .btn {
                width: auto; /* Revert to auto width on larger screens */
            }
        }

        /* Hero Section */
        .hero-section {
            background: linear-gradient(170deg, #f7f9ff 0%, #fdfcfa 100%);
            color: var(--color-text);
            min-height: 100vh;
            display: flex;
            align-items: center;
            overflow: hidden;
        }
        .hero-content {
            display: grid;
            grid-template-columns: 1fr;
            gap: 4rem;
            align-items: center;
            text-align: center;
        }
        
        @media (min-width: 992px) {
            .hero-content {
                grid-template-columns: 1fr 1fr;
                text-align: left;
            }
        }
        
        .hero-text {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        @media (min-width: 992px) {
            .hero-text {
                align-items: flex-start;
            }
        }
        
        .hero-text h1 {
            color: var(--color-secondary-brand);
            margin-bottom: 1.5rem;
        }
        .hero-subtitle {
            font-size: 1.25rem;
            margin-bottom: 2rem;
            color: var(--color-text-secondary);
            line-height: 1.7;
        }
        .hero-features {
            margin-top: 2.5rem;
            margin-bottom: 2.5rem;
            display: flex; 
            flex-direction: column;
            align-items: center; 
        }

        @media (min-width: 992px) {
            .hero-features {
                align-items: flex-start;
            }
        }

        .feature-item {
            display: flex;
            align-items: center;
            margin-bottom: 1rem;
            font-weight: 500;
        }
        .feature-item i {
            color: var(--color-primary);
            font-size: 1.2rem;
            margin-right: 1rem;
            width: 24px;
            text-align: center;
        }
        
        /* New Hero Visual */
        .hero-visual {
            position: relative;
            height: 500px;
            display: none; /* Hide on mobile by default */
        }
        
        @media (min-width: 992px) {
            .hero-visual {
                display: flex;
                align-items: center;
                justify-content: center;
            }
        }
        
        .visual-card {
            position: absolute;
            background: rgba(255, 255, 255, 0.7);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(45, 35, 87, 0.1);
            border-radius: var(--radius-lg);
            padding: 1.5rem;
            box-shadow: var(--shadow-lg);
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            transition: transform 0.3s ease;
        }
        .visual-card:hover {
            transform: translateY(-10px) scale(1.05) !important;
            z-index: 10;
        }
        .visual-card i {
            font-size: 2.5rem;
            color: var(--color-primary);
            margin-bottom: 1rem;
            line-height: 1;
        }
        .visual-card h3 {
            font-size: 1rem;
            font-weight: 600;
            color: var(--color-secondary-brand);
            margin: 0;
        }
        .card-1 {
            width: 180px;
            height: 180px;
            transform: rotate(-15deg) translate(-80px, -120px);
            z-index: 1;
        }
        .card-2 {
            width: 220px;
            height: 220px;
            transform: rotate(5deg);
            z-index: 2;
        }
        .card-3 {
            width: 160px;
            height: 160px;
            transform: rotate(12deg) translate(120px, 100px);
            z-index: 1;
        }


        /* Form Styles */
        .form-section {
          max-width: 800px;
          margin: 0 auto;
        }
        .section-header {
          text-align: center;
          margin-bottom: 3rem;
        }
        .section-header h2 {
          color: var(--color-secondary-brand);
        }
        .assessment-form {
          background: var(--color-surface);
          padding: 2.5rem;
          border-radius: var(--radius-lg);
          box-shadow: var(--shadow-lg);
        }
        .form-grid {
          display: grid;
          grid-template-columns: 1fr;
          gap: 1.5rem;
        }
        @media(min-width: 768px) {
            .form-grid {
                grid-template-columns: 1fr 1fr;
            }
        }
        .form-group--full {
          grid-column: 1 / -1;
        }
        .form-label {
          display: block;
          margin-bottom: 0.5rem;
          font-weight: 500;
          font-size: 0.9rem;
        }
        .form-control {
          width: 100%;
          padding: 12px;
          border: 1px solid var(--color-border);
          border-radius: var(--radius-base);
          background-color: var(--color-surface);
          color: var(--color-text);
        }
        .form-control:focus {
          outline: none;
          border-color: var(--color-primary);
          box-shadow: 0 0 0 3px var(--color-focus-ring);
        }
        .form-actions {
          display: flex;
          flex-direction: column-reverse; /* Stacks buttons and puts primary first */
          gap: 1rem; /* Space between stacked buttons */
          margin-top: 2rem;
          padding-top: 1.5rem;
          border-top: 1px solid var(--color-border);
        }
        @media (min-width: 768px) {
            .form-actions {
                flex-direction: row; /* Revert to row on larger screens */
                justify-content: space-between;
            }
        }

        /* Questionnaire Styles */
        .questionnaire-header {
            background: var(--color-surface);
            padding: 1.5rem;
            border-radius: var(--radius-lg);
            margin-bottom: 2rem;
            box-shadow: var(--shadow-sm);
        }
        .progress-bar-container {
            background-color: var(--color-secondary);
            border-radius: 999px;
            height: 10px;
            overflow: hidden;
        }
        .progress-bar {
            background-color: var(--color-primary);
            height: 100%;
            transition: width 0.3s ease;
        }
        .dimension-info {
            text-align: center;
            margin-bottom: 2rem;
        }
        .maturity-scale-legend {
            background-color: var(--color-secondary);
            padding: 1.5rem;
            border-radius: var(--radius-lg);
            margin-bottom: 2rem;
            border-left: 5px solid var(--color-primary);
        }
        .maturity-scale-legend h3 {
            margin-top: 0;
            color: var(--color-secondary-brand);
        }
        .dimension-group {
            margin-bottom: 2.5rem;
            padding: 1.5rem;
            border-radius: var(--radius-lg);
            background-color: #fff;
            box-shadow: var(--shadow-sm);
        }
        .dimension-group h3 {
            color: var(--color-secondary-brand);
            border-bottom: 2px solid var(--color-primary);
            padding-bottom: 0.5rem;
            margin-bottom: 1.5rem;
        }
        .question-card {
            margin-bottom: 1.5rem;
            padding-bottom: 1.5rem;
            border-bottom: 1px solid var(--color-border);
        }
        .question-card:last-child {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }
        .question-text {
            font-size: 1.1rem;
            font-weight: 500;
            margin-bottom: 1rem;
        }
        .likert-scale {
            display: flex;
            justify-content: center;
            gap: 1rem;
        }
        .likert-option input[type="radio"] {
            display: none;
        }
        .likert-option label {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 40px;
            height: 40px;
            border: 2px solid var(--color-border);
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        .likert-option input[type="radio"]:checked + label {
            background-color: var(--color-primary);
            color: white;
            border-color: var(--color-primary);
        }
        .likert-option label:hover {
            background-color: var(--color-secondary);
            border-color: var(--color-primary);
        }
        .classification-options .radio-option {
            margin-bottom: 0.5rem;
        }
        .classification-options .radio-option label {
            margin-left: 0.5rem;
        }
        .questionnaire-navigation {
            display: flex;
            flex-direction: column-reverse;
            gap: 1rem;
            margin-top: 2rem;
        }
        @media (min-width: 768px) {
            .questionnaire-navigation {
                flex-direction: row;
                justify-content: space-between;
            }
        }
        

        /* Results Dashboard */
        .results-header {
          text-align: center;
          margin-bottom: 3rem;
        }
        .results-summary {
          display: grid;
          grid-template-columns: 1fr;
          gap: 2rem;
          margin-bottom: 3rem;
          align-items: start;
        }
        @media(min-width: 992px) {
            .results-summary {
                grid-template-columns: 1fr 1.5fr;
            }
        }
        .main-score {
          background: var(--color-surface);
          border-radius: var(--radius-lg);
          padding: 2rem;
          text-align: center;
          box-shadow: var(--shadow-md);
        }
        .score-circle .score-value {
            font-size: 4rem;
            font-weight: 700;
            color: var(--color-primary);
        }
        .level-badge {
            padding: 0.5em 1em;
            border-radius: 999px;
            font-weight: 600;
            font-size: 0.9rem;
            color: #fff;
        }
        .level-badge.inexistente { background-color: #757575; }
        .level-badge.básico { background-color: #ef5350; }
        .level-badge.padronizado { background-color: #ffb74d; }
        .level-badge.gerenciado { background-color: #66bb6a; }
        .level-badge.avançado { background-color: #26a69a; }
        .quick-insights {
          display: grid;
          gap: 1.5rem;
        }
        .insight-card {
          background: var(--color-surface);
          border-radius: var(--radius-lg);
          padding: 1.5rem;
          box-shadow: var(--shadow-sm);
        }
        .insight-card h3 i {
            color: var(--color-primary);
        }
        .insight-card ul {
          list-style-type: none;
          padding-left: 0;
          margin: 0;
        }
        .insight-card li {
          padding: 0.5rem 0;
          border-bottom: 1px solid var(--color-border);
        }
        .insight-card li:last-child {
          border: none;
        }

        .charts-section {
            margin-bottom: 3rem;
            background-color: var(--color-surface);
            padding: 2rem;
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-sm);
        }
        .chart-container {
            height: 450px; /* Adjusted height for radar chart */
        }
        .classification-results-section {
            margin-top: 3rem;
        }
        .classification-results-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
        }
        .classification-result-card {
            background-color: var(--color-surface);
            padding: 1.5rem;
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-sm);
        }
        .classification-result-card .question {
            font-weight: 600;
            color: var(--color-secondary-brand);
            margin-bottom: 0.5rem;
        }
        .classification-result-card .answer {
            color: var(--color-primary);
            font-weight: 500;
        }

        .results-actions {
          display: flex;
          flex-direction: column;
          align-items: center;
          gap: 1.5rem;
          margin-top: 3rem;
        }
        .report-email-notice {
            text-align: center;
            color: var(--color-text-secondary);
            font-style: italic;
            max-width: 450px;
        }


        /* Notification Styles */
        .notification {
          position: fixed;
          top: 20px;
          right: 20px;
          padding: 12px 20px;
          border-radius: var(--radius-base);
          color: white;
          font-weight: 500;
          z-index: 1000;
          opacity: 0;
          transform: translateX(100%);
          transition: all 0.3s ease-in-out;
          box-shadow: var(--shadow-lg);
        }
        .notification.show {
          opacity: 1;
          transform: translateX(0);
        }
        .notification.success { background-color: var(--color-success); }
        .notification.error { background-color: var(--color-error); }
        .notification.info { background-color: var(--color-info); }

    </style>
</head>
<body>
    <!-- Landing Page -->
    <section id="landing-page" class="page active">
        <div class="hero-section">
            <div class="container">
                <div class="hero-content">
                    <div class="hero-text">
                        <h1>Transforme seu Ciclo de Receita</h1>
                        <p class="hero-subtitle">Descubra o nível de maturidade da sua gestão financeira e identifique oportunidades de otimização com nossa ferramenta de diagnóstico completa.</p>
                        
                        <button class="btn btn--primary btn--lg" onclick="startAssessment()">
                            <i class="fas fa-play"></i>
                            Iniciar Diagnóstico Gratuito
                        </button>

                        <div class="hero-features">
                            <div class="feature-item">
                                <i class="fas fa-tasks"></i>
                                <span>Análise Abrangente</span>
                            </div>
                            <div class="feature-item">
                                <i class="fas fa-chart-bar"></i>
                                <span>Relatório Instantâneo</span>
                            </div>
                            <div class="feature-item">
                                <i class="fas fa-lightbulb"></i>
                                <span>Recomendações Práticas</span>
                            </div>
                        </div>
                    </div>
                    <div class="hero-visual">
                        <div class="visual-card card-1">
                           <i class="fas fa-file-invoice-dollar"></i>
                           <h3>Faturamento</h3>
                        </div>
                        <div class="visual-card card-2">
                           <i class="fas fa-chart-pie"></i>
                           <h3>Análise de Dados</h3>
                        </div>
                         <div class="visual-card card-3">
                           <i class="fas fa-file-signature"></i>
                           <h3>Contratos</h3>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Institutional Data Form -->
    <section id="institutional-form" class="page">
        <div class="container">
            <div class="form-section">
                <div class="section-header">
                    <h2>Dados Institucionais</h2>
                    <p>Por favor, forneça as informações básicas sobre sua instituição.</p>
                </div>

                <form id="institution-form" class="assessment-form">
                    <div class="form-grid">
                        <div class="form-group">
                            <label class="form-label" for="institution-name">Nome da Instituição *</label>
                            <input type="text" id="institution-name" class="form-control" required>
                        </div>

                        <div class="form-group">
                            <label class="form-label" for="institution-type">Tipo de Instituição *</label>
                            <select id="institution-type" class="form-control" required>
                                <option value="">Selecione...</option>
                                <option value="hospital-geral">Hospital Geral</option>
                                <option value="hospital-especializado">Hospital Especializado</option>
                                <option value="clinica">Clínica</option>
                                <option value="centro-diagnostico">Centro de Diagnóstico</option>
                                <option value="laboratorio">Laboratório</option>
                                <option value="outro">Outro</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label class="form-label" for="beds-count">Número de Leitos</label>
                            <input type="number" id="beds-count" class="form-control" min="0">
                        </div>

                        <div class="form-group">
                            <label class="form-label" for="region">Região/Estado *</label>
                            <input type="text" id="region" class="form-control" required>
                        </div>

                        <div class="form-group">
                            <label class="form-label" for="respondent-name">Nome do Respondente *</label>
                            <input type="text" id="respondent-name" class="form-control" required>
                        </div>

                        <div class="form-group">
                            <label class="form-label" for="respondent-role">Cargo do Respondente *</label>
                            <input type="text" id="respondent-role" class="form-control" required>
                        </div>

                        <div class="form-group form-group--full">
                            <label class="form-label" for="contact-email">Email de Contato *</label>
                            <input type="email" id="contact-email" class="form-control" required>
                        </div>
                    </div>

                    <div class="form-actions">
                        <button type="button" class="btn btn--outline" onclick="goToLanding()">
                            <i class="fas fa-arrow-left"></i>
                            Voltar
                        </button>
                        <button type="submit" class="btn btn--primary">
                            Continuar para o Questionário
                            <i class="fas fa-arrow-right"></i>
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </section>

    <!-- Assessment Questionnaire -->
    <section id="assessment-questionnaire" class="page">
        <div class="container">
            <div class="questionnaire-header">
                 <div class="progress-section">
                    <div class="progress-info">
                        <span class="progress-text">Seção <span id="current-dimension">1</span> de 2</span>
                        <span class="progress-percentage" id="progress-percentage">50%</span>
                    </div>
                    <div class="progress-bar-container">
                        <div class="progress-bar" id="progress-bar" style="width: 50%;"></div>
                    </div>
                </div>
            </div>

            <div class="questionnaire-content">
                <div class="dimension-info">
                    <h2 id="dimension-title">Maturidade do Ciclo da Receita</h2>
                    <p id="dimension-description">Para cada uma das perguntas abaixo, avalie o grau de maturidade da sua instituição com base na escala de 1 a 5.</p>
                </div>

                <div class="maturity-scale-legend">
                    <h3>Legenda da Escala de Maturidade</h3>
                    <p><strong>1 - Inexistente:</strong> Nenhum processo formal; ações apenas reativas.</p>
                    <p><strong>2 - Básico:</strong> Processo parcialmente adotado, sem padronização ou monitoramento regular.</p>
                    <p><strong>3 - Padronizado:</strong> Processo claramente documentado e conhecido pelas equipes.</p>
                    <p><strong>4 - Gerenciado:</strong> Processo padronizado, monitorado regularmente, com ajustes pontuais.</p>
                    <p><strong>5 - Avançado:</strong> Processo digitalizado, automatizado, integrado e com melhoria contínua.</p>
                </div>

                <form id="questionnaire-form">
                    <div class="questions-container" id="questions-container">
                        <!-- Questions will be dynamically populated -->
                    </div>

                    <div class="questionnaire-navigation">
                        <button type="button" class="btn btn--outline" id="prev-btn" onclick="previousDimension()" disabled>
                            <i class="fas fa-arrow-left"></i>
                            Anterior
                        </button>
                        <button type="button" class="btn btn--primary" id="next-btn" onclick="nextDimension()">
                            Próximo
                            <i class="fas fa-arrow-right"></i>
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </section>
    
    <!-- Classification Questions -->
    <section id="classification-questions" class="page">
        <div class="container">
            <div class="questionnaire-header">
                 <div class="progress-section">
                    <div class="progress-info">
                        <span class="progress-text">Seção 2 de 2</span>
                        <span class="progress-percentage" id="progress-percentage-class">100%</span>
                    </div>
                    <div class="progress-bar-container">
                        <div class="progress-bar" id="progress-bar-class" style="width: 100%;"></div>
                    </div>
                </div>
            </div>
            <div class="questionnaire-content">
                <div class="dimension-info">
                    <h2 id="classification-title">Indicadores Quantitativos - Maturidade do Fluxo de Caixa</h2>
                    <p id="classification-description">Responda às perguntas classificatórias abaixo.</p>
                </div>
                <form id="classification-form">
                    <div class="questions-container" id="classification-questions-container">
                        <!-- Classification questions will be dynamically populated -->
                    </div>
                    <div class="questionnaire-navigation">
                        <button type="button" class="btn btn--outline" onclick="goToQuestionnaire()">
                            <i class="fas fa-arrow-left"></i>
                            Anterior
                        </button>
                        <button type="button" class="btn btn--primary" onclick="finishAssessment()">
                            Finalizar e Ver Resultados
                            <i class="fas fa-check"></i>
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </section>

    <!-- Results Dashboard -->
    <section id="results-dashboard" class="page">
        <div class="container">
            <div class="results-header">
                <h2>Resultados do Questionário</h2>
                <p>Análise da maturidade do ciclo de receita da sua instituição.</p>
            </div>

            <div class="results-summary">
                <div class="score-card main-score">
                    <div class="score-circle">
                        <div class="score-value" id="overall-score">0.0</div>
                        <div class="score-label">Score Geral de Maturidade</div>
                    </div>
                    <div class="maturity-level">
                        <div class="level-badge" id="maturity-badge">Inexistente</div>
                        <div class="level-description" id="maturity-description">Nenhum processo formal; ações apenas reativas.</div>
                    </div>
                </div>

                <div class="quick-insights">
                    <div class="insight-card strengths">
                        <h3><i class="fas fa-thumbs-up"></i> Pontos Fortes</h3>
                        <ul id="strengths-list">
                            <!-- Populated dynamically -->
                        </ul>
                    </div>
                    <div class="insight-card opportunities">
                        <h3><i class="fas fa-lightbulb"></i> Oportunidades de Melhoria</h3>
                        <ul id="opportunities-list">
                            <!-- Populated dynamically -->
                        </ul>
                    </div>
                </div>
            </div>

            <div class="charts-section">
                <div class="chart-container">
                    <canvas id="dimensions-chart"></canvas>
                </div>
            </div>
            
            <div class="classification-results-section">
                <h3>Respostas - Indicadores Quantitativos</h3>
                <div id="classification-results-container">
                     <!-- Classification results will be displayed here -->
                </div>
            </div>


            <div class="results-actions">
                 <p class="report-email-notice">Obrigado por responder! Um relatório completo com mais detalhes será enviado para o seu e-mail.</p>
                <button class="btn btn--outline" onclick="restartAssessment()">
                    <i class="fas fa-redo"></i>
                    Reiniciar Questionário
                </button>
            </div>
        </div>
    </section>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        // Global variables
        let currentPage = 'landing-page';
        let currentDimension = 0;
        let assessmentData = {};
        let institutionalData = {};
        let questionnaireData = {};
        let classificationData = {};

        // Assessment data structure - Updated for Revenue Cycle Maturity
        const assessmentStructure = {
            "title": "Questionário de Maturidade do Ciclo da Receita",
            "dimensions": [
                {
                    "id": "d1",
                    "name": "Contrato",
                    "questions": [
                        { "id": "q1_1", "text": "Os contratos são formalizados, digitalizados e revisados regularmente para equilíbrio econômico?" },
                        { "id": "q1_2", "text": "Indicadores de prazo médio, glosas e rentabilidade por operadora são monitorados?" }
                    ]
                },
                {
                    "id": "d2",
                    "name": "Autorização",
                    "questions": [
                        { "id": "q2_1", "text": "O processo de autorização prévia é automatizado, integrado ao sistema e oferece autosserviço?" },
                        { "id": "q2_2", "text": "Indicadores de autorizações (tempo de resposta, negativas e pendências) são acompanhados?" }
                    ]
                },
                {
                    "id": "d3",
                    "name": "Pré-Cadastro",
                    "questions": [
                        { "id": "q3_1", "text": "O pré-cadastro é digitalizado, validado automaticamente e integrado ao faturamento?" }
                    ]
                },
                {
                    "id": "d4",
                    "name": "Admissão",
                    "questions": [
                        { "id": "q4_1", "text": "A admissão do paciente é padronizada e integrada em tempo real ao sistema de faturamento?" },
                        { "id": "q4_2", "text": "Indicadores de qualidade (retrabalho, erros, tempo de espera) na admissão são monitorados?" }
                    ]
                },
                {
                    "id": "d5",
                    "name": "Assistência",
                    "questions": [
                        { "id": "q5_1", "text": "Registros assistenciais são eletrônicos, estruturados e integrados ao faturamento em tempo real?" },
                        { "id": "q5_2", "text": "A equipe assistencial recebe treinamentos regulares sobre impacto dos registros no faturamento?" }
                    ]
                },
                {
                    "id": "d6",
                    "name": "Auditorias",
                    "questions": [
                        { "id": "q6_1", "text": "Auditorias internas são realizadas antes do faturamento com análise das glosas e implementação prática de melhorias?" }
                    ]
                },
                {
                    "id": "d7",
                    "name": "Faturamento",
                    "questions": [
                        { "id": "q7_1", "text": "O faturamento é automatizado com regras de validação e acompanhamento contínuo de indicadores?" }
                    ]
                },
                {
                    "id": "d8",
                    "name": "Glosas",
                    "questions": [
                        { "id": "q8_1", "text": "Existe processo padronizado de gestão de glosas (contestação, classificação, análise e ações corretivas)?" }
                    ]
                }
            ],
            "classification_questions": [
                {
                    "id": "cq1",
                    "text": "Qual é o prazo médio real de recebimento após faturamento?",
                    "options": ["Mais de 120 dias", "90 a 120 dias", "60 a 90 dias", "30 a 60 dias", "Menos de 30 dias"]
                },
                {
                    "id": "cq2",
                    "text": "Qual o percentual médio final de glosas após recurso das operadoras?",
                    "options": ["Mais de 15%", "10 a 15%", "5 a 10%", "1 a 5%", "Menos de 1%"]
                },
                {
                    "id": "cq3",
                    "text": "Qual percentual médio do custo operacional (pessoal e contratos técnicos) sobre a receita bruta?",
                    "options": ["Mais de 60%", "50 a 60%", "40 a 50%", "30 a 40%", "Menos de 30%"]
                },
                {
                    "id": "cq4",
                    "text": "Qual foi o nível de redução dos investimentos planejados (CAPEX) nos últimos 12 meses?",
                    "options": ["Mais de 50% dos investimentos cortados", "30 a 50% dos investimentos cortados", "10 a 30% dos investimentos cortados", "Menos de 10% dos investimentos cortados", "Nenhuma redução (investimentos mantidos ou aumentados)"]
                },
                {
                    "id": "cq5",
                    "text": "A instituição possui planejamento estratégico com cálculo e acompanhamento formal de ROI em seus investimentos?",
                    "options": ["Não há planejamento estratégico formal nem análise de ROI", "Planejamento estratégico incipiente, sem cálculo de ROI", "Planejamento estratégico definido, ROI calculado em poucos projetos", "Planejamento bem estruturado, ROI avaliado em projetos prioritários", "Planejamento estratégico maduro, ROI integrado em todos os projetos"]
                }
            ],
            "maturity_levels": {
                "1": { "name": "Inexistente", "range": [1.0, 1.5], "description": "Nenhum processo formal; ações apenas reativas." },
                "2": { "name": "Básico", "range": [1.5, 2.5], "description": "Processo parcialmente adotado, sem padronização ou monitoramento regular." },
                "3": { "name": "Padronizado", "range": [2.5, 3.5], "description": "Processo claramente documentado e conhecido pelas equipes." },
                "4": { "name": "Gerenciado", "range": [3.5, 4.5], "description": "Processo padronizado, monitorado regularmente, com ajustes pontuais." },
                "5": { "name": "Avançado", "range": [4.5, 5.0], "description": "Processo digitalizado, automatizado, integrado e com melhoria contínua." }
            }
        };

        // Initialize application
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
        });

        function initializeApp() {
            // Initialize data structures
            questionnaireData = {};
            assessmentStructure.dimensions.forEach(dimension => {
                questionnaireData[dimension.id] = {};
                dimension.questions.forEach(question => {
                    questionnaireData[dimension.id][question.id] = { maturity: null };
                });
            });

            classificationData = {};
            assessmentStructure.classification_questions.forEach(q => {
                classificationData[q.id] = null;
            });

            setupFormHandlers();
            showPage('landing-page');
        }

        function setupFormHandlers() {
            const institutionForm = document.getElementById('institution-form');
            if (institutionForm) {
                institutionForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    handleInstitutionForm();
                });
            }
        }

        // Page navigation
        function showPage(pageId) {
            document.querySelectorAll('.page').forEach(page => page.classList.remove('active'));
            const targetPage = document.getElementById(pageId);
            if (targetPage) {
                targetPage.classList.add('active');
                currentPage = pageId;
            }
        }

        function startAssessment() {
            showPage('institutional-form');
        }

        function goToLanding() {
            showPage('landing-page');
        }

        function handleInstitutionForm() {
            institutionalData = {
                name: document.getElementById('institution-name').value,
                type: document.getElementById('institution-type').value,
                beds: document.getElementById('beds-count').value,
                region: document.getElementById('region').value,
                respondentName: document.getElementById('respondent-name').value,
                respondentRole: document.getElementById('respondent-role').value,
                email: document.getElementById('contact-email').value
            };

            const requiredFields = ['name', 'type', 'region', 'respondentName', 'respondentRole', 'email'];
            if (requiredFields.some(field => !institutionalData[field])) {
                showNotification('Por favor, preencha todos os campos obrigatórios.', 'error');
                return;
            }

            loadQuestionnaire();
            showPage('assessment-questionnaire');
        }

        function loadQuestionnaire() {
            const questionsContainer = document.getElementById('questions-container');
            questionsContainer.innerHTML = '';

            assessmentStructure.dimensions.forEach(dimension => {
                const dimensionGroup = document.createElement('div');
                dimensionGroup.className = 'dimension-group';
                dimensionGroup.innerHTML = `<h3>${dimension.name}</h3>`;
                
                dimension.questions.forEach(question => {
                    const questionCard = createMaturityQuestionCard(question, dimension.id);
                    dimensionGroup.appendChild(questionCard);
                });
                questionsContainer.appendChild(dimensionGroup);
            });
            
            document.getElementById('next-btn').textContent = 'Próximo';
            
            restoreMaturityAnswers();
        }

        function createMaturityQuestionCard(question, dimensionId) {
            const card = document.createElement('div');
            card.className = 'question-card';
            card.innerHTML = `
                <div class="question-text">${question.text}</div>
                <div class="likert-scale">
                    ${createLikertOptions(question.id, dimensionId, 'maturity')}
                </div>
            `;
            return card;
        }

        function createLikertOptions(questionId, dimensionId, type) {
            let options = '';
            for (let i = 1; i <= 5; i++) {
                const name = `${dimensionId}_${questionId}_${type}`;
                options += `
                    <div class="likert-option">
                        <input type="radio" id="${name}_${i}" name="${name}" value="${i}" onchange="saveMaturityAnswer('${dimensionId}', '${questionId}', ${i})">
                        <label for="${name}_${i}">${i}</label>
                    </div>
                `;
            }
            return options;
        }

        function saveMaturityAnswer(dimensionId, questionId, value) {
            if (!questionnaireData[dimensionId]) {
                questionnaireData[dimensionId] = {};
            }
            if (!questionnaireData[dimensionId][questionId]) {
                questionnaireData[dimensionId][questionId] = {};
            }
            questionnaireData[dimensionId][questionId].maturity = parseInt(value, 10);
        }

        function restoreMaturityAnswers() {
            for (const dimId in questionnaireData) {
                for (const qId in questionnaireData[dimId]) {
                    const answer = questionnaireData[dimId][qId].maturity;
                    if (answer) {
                        const radio = document.querySelector(`input[name="${dimId}_${qId}_maturity"][value="${answer}"]`);
                        if (radio) radio.checked = true;
                    }
                }
            }
        }


        function validateMaturityQuestions() {
            for (const dim of assessmentStructure.dimensions) {
                for (const q of dim.questions) {
                    if (!questionnaireData[dim.id][q.id] || questionnaireData[dim.id][q.id].maturity === null) {
                        return false;
                    }
                }
            }
            return true;
        }

        function nextDimension() {
            if (!validateMaturityQuestions()) {
                showNotification('Por favor, responda todas as perguntas de maturidade.', 'error');
                return;
            }
            loadClassificationQuestions();
            showPage('classification-questions');
        }

        function previousDimension() {
             showPage('assessment-questionnaire');
        }

        function goToQuestionnaire() {
            showPage('assessment-questionnaire');
        }


        function loadClassificationQuestions() {
            const container = document.getElementById('classification-questions-container');
            container.innerHTML = '';

            assessmentStructure.classification_questions.forEach(q => {
                const card = document.createElement('div');
                card.className = 'question-card';
                card.innerHTML = `
                    <div class="question-text">${q.text}</div>
                    <div class="classification-options">
                        ${q.options.map((opt, index) => `
                            <div class="radio-option">
                                <input type="radio" id="${q.id}_${index}" name="${q.id}" value="${opt}" onchange="saveClassificationAnswer('${q.id}', '${opt}')">
                                <label for="${q.id}_${index}">${opt}</label>
                            </div>
                        `).join('')}
                    </div>
                `;
                container.appendChild(card);
            });

            restoreClassificationAnswers();
        }

        function saveClassificationAnswer(questionId, value) {
            classificationData[questionId] = value;
        }

        function restoreClassificationAnswers() {
            for (const qId in classificationData) {
                const answer = classificationData[qId];
                if (answer) {
                    const radio = document.querySelector(`input[name="${qId}"][value="${answer}"]`);
                    if (radio) radio.checked = true;
                }
            }
        }

        function validateClassificationQuestions() {
            return assessmentStructure.classification_questions.every(q => classificationData[q.id] !== null);
        }
        
        function sendDataToSheet(data) {
            const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbyx-RwfO700g8M7Ig5L-WvON2FGjw9LaqHVyuT8sT1CxDQHdozBdwrjLXnir7Q0ntY2/exec';
            
            const chartImage = window.myDimensionsChart.toBase64Image();

            const rowData = {
                timestamp: data.timestamp,
                institutionName: data.institutional.name,
                institutionType: data.institutional.type,
                bedsCount: data.institutional.beds,
                region: data.institutional.region,
                respondentName: data.institutional.respondentName,
                respondentRole: data.institutional.respondentRole,
                contactEmail: data.institutional.email,
                overallScore: data.overallScore.toFixed(2),
                maturityLevel: data.maturityLevel.name,
                strengths: data.strengths.join(', '),
                opportunities: data.opportunities.join(', '),
            };

            // **CORREÇÃO AQUI**: Adicionar as pontuações de cada dimensão ao payload
            assessmentStructure.dimensions.forEach(dim => {
                const scoreData = data.scores[dim.id];
                if(scoreData) {
                    // Chave que corresponde à esperada pelo Apps Script (ex: "Contrato_score")
                    rowData[`${scoreData.name}_score`] = scoreData.score; 
                }
            });

            assessmentStructure.dimensions.forEach(dim => {
                dim.questions.forEach(q => {
                    const questionKey = `${dim.name} - ${q.id}`;
                    rowData[questionKey] = data.responses[dim.id][q.id]?.maturity || "";
                });
            });

            assessmentStructure.classification_questions.forEach(q => {
                const questionKey = `Class: ${q.text}`;
                rowData[questionKey] = data.classificationResponses[q.id] || "";
            });
            
            const payload = { ...rowData, chartImage: chartImage };

            showNotification('Enviando respostas e preparando seu e-mail...', 'info');

            fetch(SCRIPT_URL, {
                method: 'POST',
                mode: 'cors',
                cache: 'no-cache',
                headers: { 'Content-Type': 'text/plain;charset=utf-8' },
                body: JSON.stringify(payload),
            })
            .then(res => res.json())
            .then(response => {
                if (response.result === 'success') {
                    showNotification('Respostas salvas e e-mail enviado com sucesso!', 'success');
                } else {
                    throw new Error(response.message || 'Erro desconhecido ao salvar.');
                }
            })
            .catch(error => {
                console.error('Erro ao enviar dados para o Google Sheet:', error);
                showNotification(`Erro ao salvar: ${error.message}`, 'error');
            });
        }


        function finishAssessment() {
            if (!validateClassificationQuestions()) {
                showNotification('Por favor, responda todas as perguntas classificatórias.', 'error');
                return;
            }
            calculateResults();
            showPage('results-dashboard');
            displayResults();
            
            setTimeout(() => {
                sendDataToSheet(assessmentData);
            }, 500); 
        }

        function calculateResults() {
            assessmentData = {
                institutional: institutionalData,
                responses: questionnaireData,
                classificationResponses: classificationData,
                scores: {},
                overallScore: 0,
                maturityLevel: null,
                strengths: [],
                opportunities: [],
                timestamp: new Date().toISOString()
            };
            
            let totalScore = 0;
            let totalQuestions = 0;

            assessmentStructure.dimensions.forEach(dimension => {
                let dimensionScore = 0;
                let questionCount = dimension.questions.length;
                totalQuestions += questionCount;

                dimension.questions.forEach(question => {
                    const answer = questionnaireData[dimension.id][question.id];
                    if (answer && answer.maturity) {
                        dimensionScore += answer.maturity;
                    }
                });
                
                const avgScore = questionCount > 0 ? dimensionScore / questionCount : 0;
                assessmentData.scores[dimension.id] = {
                    name: dimension.name,
                    score: avgScore,
                    percentage: (avgScore / 5) * 100
                };
                totalScore += dimensionScore;

                if (avgScore >= 4.0) {
                    assessmentData.strengths.push(dimension.name);
                } else if (avgScore < 3.0) {
                    assessmentData.opportunities.push(dimension.name);
                }
            });
            
            assessmentData.overallScore = totalQuestions > 0 ? totalScore / totalQuestions : 0;
            
            for (const level in assessmentStructure.maturity_levels) {
                const levelData = assessmentStructure.maturity_levels[level];
                const [min, max] = levelData.range;
                if (level === '5' && assessmentData.overallScore >= min && assessmentData.overallScore <= max) {
                     assessmentData.maturityLevel = {
                        level: level,
                        name: levelData.name,
                        description: levelData.description
                    };
                    break;
                }
                if (assessmentData.overallScore >= min && assessmentData.overallScore < max) {
                    assessmentData.maturityLevel = {
                        level: level,
                        name: levelData.name,
                        description: levelData.description
                    };
                    break;
                }
            }
            
             if (!assessmentData.maturityLevel && assessmentData.overallScore === 5) {
                assessmentData.maturityLevel = assessmentStructure.maturity_levels['5'];
            }
        }


        function displayResults() {
            document.getElementById('overall-score').textContent = assessmentData.overallScore.toFixed(1);
            
            const maturityBadge = document.getElementById('maturity-badge');
            const maturityDescription = document.getElementById('maturity-description');
            if (assessmentData.maturityLevel) {
                maturityBadge.textContent = assessmentData.maturityLevel.name;
                maturityBadge.className = `level-badge ${assessmentData.maturityLevel.name.toLowerCase().replace(' ','-')}`;
                maturityDescription.textContent = assessmentData.maturityLevel.description;
            }
            
            const strengthsList = document.getElementById('strengths-list');
            strengthsList.innerHTML = assessmentData.strengths.length ?
                assessmentData.strengths.map(s => `<li>${s}</li>`).join('') :
                '<li>Nenhum ponto forte (score ≥ 4.0) identificado.</li>';

            const opportunitiesList = document.getElementById('opportunities-list');
            opportunitiesList.innerHTML = assessmentData.opportunities.length ?
                assessmentData.opportunities.map(o => `<li>${o}</li>`).join('') :
                '<li>Nenhuma oportunidade crítica (score < 3.0) identificada.</li>';

            displayClassificationResults();
            createDimensionsChart();
        }


        function displayClassificationResults() {
            const container = document.getElementById('classification-results-container');
            container.innerHTML = '';
            
            const grid = document.createElement('div');
            grid.className = 'classification-results-grid';

            assessmentStructure.classification_questions.forEach(q => {
                const answer = assessmentData.classificationResponses[q.id];
                const resultCard = document.createElement('div');
                resultCard.className = 'classification-result-card';
                resultCard.innerHTML = `
                    <p class="question">${q.text}</p>
                    <p class="answer">${answer || 'Não respondido'}</p>
                `;
                grid.appendChild(resultCard);
            });
        }


        function createDimensionsChart() {
            const ctx = document.getElementById('dimensions-chart').getContext('2d');
            
            if (window.myDimensionsChart) {
                window.myDimensionsChart.destroy();
            }

            const labels = assessmentStructure.dimensions.map(d => d.name);
            const data = assessmentStructure.dimensions.map(d => assessmentData.scores[d.id].score);
            
            window.myDimensionsChart = new Chart(ctx, {
                type: 'radar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Score de Maturidade',
                        data: data,
                        backgroundColor: 'rgba(235, 104, 86, 0.2)',
                        borderColor: '#EB6856',
                        pointBackgroundColor: '#EB6856',
                        pointBorderColor: '#fff',
                        pointHoverBackgroundColor: '#fff',
                        pointHoverBorderColor: '#EB6856',
                        borderWidth: 2,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    elements: { line: { borderWidth: 3 } },
                    scales: {
                        r: {
                            angleLines: { display: true, color: 'rgba(45, 35, 87, 0.1)' },
                            suggestedMin: 0,
                            suggestedMax: 5,
                            grid: { color: 'rgba(45, 35, 87, 0.1)' },
                            pointLabels: { font: { size: 12, weight: '500' }, color: '#2D2357' },
                            ticks: { beginAtZero: true, max: 5, min: 0, stepSize: 1, backdropColor: 'transparent', color: '#5b647c' }
                        }
                    },
                    plugins: {
                        legend: { position: 'top' },
                        title: { display: true, text: 'Análise por Dimensão da Maturidade', font: { size: 18 }, color: '#2D2357' }
                    }
                }
            });
        }

        function restartAssessment() {
            currentDimension = 0;
            assessmentData = {};
            institutionalData = {};
            initializeApp();
            showNotification('Questionário reiniciado com sucesso!', 'success');
            showPage('landing-page');
        }

        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.textContent = message;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.classList.add('show');
            }, 100);
            
            setTimeout(() => {
                notification.classList.remove('show');
                setTimeout(() => {
                    if (document.body.contains(notification)) {
                        document.body.removeChild(notification);
                    }
                }, 300);
            }, 4000);
        }
    </script>
</body>
</html>
